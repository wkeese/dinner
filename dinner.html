<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>What's for dinner?</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body {
            background: #ffffff;
            background: linear-gradient(2deg, rgba(255, 255, 255, 1) 0%, rgba(148, 187, 233, 1) 100%);
        }

        /* Button to pick one of the possible meals. */
        #pickerContainer {
            display: flex;
            flex-direction: row;
            align-items: center;
            font-size: 400%;
            gap: 10px;
        }
        #pickOneButton {
            font-size: 100%;
            border: none;
            background: none !important;
            cursor: grab;

            animation:spin 4s linear infinite;
        }
        @keyframes spin {
            100% {
                transform:rotate(360deg);
            }
        }
        #result {
            line-height: 200%;
        }

        fieldset {
            margin-bottom: 10px;

            ul {
                list-style: none;
            }
        }

        /* Style checkboxes to look like toggle buttons. */
        #ingredients {
            /* Multi column layout. */
            column-count: auto;
            column-width: 16rem;

            input {
                display: none;
            }

            label {
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                cursor: pointer;
                border: solid 1px transparent;
                background: white;
                padding: 5px;
                margin: 5px;
                transition: all 200ms;

                &::after {
                    /* To prevent height change, always render checkbox, but toggle visibility. */
                    content: "âœ…";
                    visibility: hidden;
                }
            }
            input:checked + label {
                border-color: black;
                background: beige;

                &::after {
                    visibility: visible;
                }
            }
        }

        /* Style meals */
        #meals {
              /* Multi column layout. */
              column-count: auto;
              column-width: 20rem;

              li {
                  padding: 5px;
                  transition: all 200ms;
              }

              /* Styling only for when one or more ingredients are selected. */
              li.matched {
                  color: navy;
                  font-size: 110%;
              }

            fieldset:has(input:checked) + fieldset & li:not(.matched) {
                padding: 0;
                font-size: 0%;
            }
          }


        * {
            text-transform: capitalize;
        }
    </style>
</head>
<body>
<h1>What's for dinner?</h1>

<div id="pickerContainer">
    <button type="button" id="pickOneButton" onclick="pickOne();">ðŸŽ²</button> â†’ <span id="result">&nbsp;</span>
</div>

<fieldset>
    <legend>Leftover Ingredients</legend>
    <ul id="ingredients"></ul>
</fieldset>

<fieldset>
    <legend>Possible meals</legend>
    <ul id="meals"></ul>
</fieldset>

<script>
  const ingredients = [
    {
      "icon": "",
      "name": "asparagus"
    },
    {
      "icon": "ðŸ¥‘",
      "name": "avocados"
    },
    {
      "icon": "ðŸ¥“",
      "name": "bacon"
    },
    {
      "icon": "",
      "name": "cabbage"
    },
    {
      "icon": "ðŸ¥•",
      "name": "carrots"
    },
    {
      "icon": "",
      "name": "celery"
    },
    {
      "icon": "ðŸ§€",
      "name": "cheese"
    },
    {
      "icon": "ðŸ”",
      "name": "chicken"
    },
    {
      "icon": "ðŸ¥›",
      "name": "cream"
    },
    {
      "icon": "ðŸ¥’",
      "name": "cucumbers"
    },
    {
      "icon": "ðŸ†",
      "name": "eggplant"
    },
    {
      "icon": "ðŸ¥š",
      "name": "eggs"
    },
    {
      "icon": "ðŸ¥¬",
      "name": "lettuce"
    },
    {
      "icon": "ðŸ§€",
      "name": "mozarella"
    },
    {
      "icon": "ðŸ„",
      "name": "mushrooms"
    },
    {
      "icon": "ðŸ¥”",
      "name": "potatoes"
    },
    {
      "icon": "ðŸŽƒ",
      "name": "pumpkin"
    },
    {
      "icon": "ðŸ·",
      "name": "red wine"
    },
    {
      "icon": "",
      "name": "salami"
    },
    {
      "icon": "ðŸŒ­",
      "name": "sausage"
    },
    {
      "icon": "ðŸ¥¬",
      "name": "spinach"
    },
    {
      "icon": "",
      "name": "squash"
    },
    {
      "icon": "",
      "name": "tofu"
    },
    {
      "icon": "ðŸ…",
      "name": "tomatoes"
    },
    {
      "icon": "ðŸ·",
      "name": "white wine"
    },
    {
      "icon": "",
      "name": "zucchini"
    },
    {
      "icon": "ðŸ ",
      "name": "ã•ã¤ã¾ã„ã‚‚"
    },
    {
      "icon": "ðŸ”",
      "name": "ã²ãè‚‰"
    },
    {
      "icon": "ðŸ«‘",
      "name": "ãƒ‘ãƒ—ãƒªã‚«"
    },
    {
      "icon": "",
      "name": "ãƒ”ãƒ¼ãƒžãƒ³"
    },
    {
      "icon": "",
      "name": "å¤§æ ¹"
    },
    {
      "icon": "ðŸ¥¬",
      "name": "ç™½èœ"
    },
    {
      "icon": "ðŸ§…",
      "name": "é•·ãƒã‚®"
    }
  ];

  const mealsData = `
        ðŸ‡®ðŸ‡¹: Lasagna: ã²ãè‚‰, mozarella
        ðŸ—: Legendary chicken: chicken, potatoes, ã•ã¤ã¾ã„ã‚‚, carrots
        ðŸ¥©: Beef stew: potatoes, carrots, red wine
        ðŸ¥©: Lamb stew: potatoes, carrots, red wine
        ðŸ½: Stuffed zucchini: zucchini, sausage, tomatoes
        ðŸ½: Stuffed peppers: ãƒ”ãƒ¼ãƒžãƒ³, ã²ãè‚‰
        ðŸ”: Hamburgers: ã²ãè‚‰, tomatoes, lettuce, avocados, mushrooms
        ðŸ—: Chicken saute chaucer: chicken, mushrooms, tomatoes, white wine
        ðŸ¥§: Chicken pot pie: potatoes, celery, carrots
        ðŸ‡²ðŸ‡½: Quesadillas: cheese, ãƒ‘ãƒ—ãƒªã‚«, chicken
        ðŸŒ®: Tacos: ã²ãè‚‰, tomatoes, avocados, cheese
        ðŸ¥—: Salad: cheese, avocados, tomatoes, lettuce, cucumbers
        ðŸ²: Lentil soup, bread, and salad: celery, carrots
        ðŸ²: Chicken noodle soup, bread, and salad: celery, carrots
        ðŸ²: Lentil spinach soup, bread, and salad: spinach
        ðŸ²: Potato pepper soup: potatoes, ãƒ‘ãƒ—ãƒªã‚«, sausage, cream
        ðŸ²: Pumpkin soup: pumpkin
        ðŸ«“: Hummus
        ðŸ¥š: Omelette: mushrooms, cheese, tomatoes, ãƒ”ãƒ¼ãƒžãƒ³
        ðŸ½: Polenta: ãƒ‘ãƒ—ãƒªã‚«, spinach, tomatoes
        ðŸ•: Pizza: tomatoes, mozarella, ãƒ”ãƒ¼ãƒžãƒ³, salami
        ðŸŸ: ã‚µãƒ, rice, and veggies
        ðŸŸ: ã‚µãƒ³ãƒž, rice, and veggies
        ðŸ²: ãã°: é•·ãƒã‚®
        ðŸ²: ã†ã©ã‚“: é•·ãƒã‚®
        ðŸœ: ãƒ©ãƒ¼ãƒ¡ãƒ³
        ðŸ½: Dipping noodles
        ðŸ‡¯ðŸ‡µ: è‚‰ã˜ã‚ƒãŒ: ã²ãè‚‰, potatoes, carrots
        ðŸ¥š: ã‚ªãƒ ãƒ©ãƒ¼ã‚¹: eggs
        ðŸ—: Roasted chicken: chicken, ã•ã¤ã¾ã„ã‚‚, potatoes
        ðŸ‡¨ðŸ‡³: ãƒãƒ£ãƒãƒ³ and é¤ƒå­
        ðŸ£: æ‰‹å·»ãå¯¿å¸: cucumbers, avocados
        ðŸ‡¯ðŸ‡µ: ã¿ã dip and veggies: carrots, cucumbers, å¤§æ ¹
        ðŸ›: Curry: chicken, potatoes, carrots, mushrooms
        ðŸ‡¯ðŸ‡µ: ã‚´ãƒžã»ã†ã‚Œã‚“è‰: spinach
        ðŸ¥—: ãƒ©ãƒ¼ãƒ¡ãƒ³ã‚µãƒ©ãƒ€: cucumbers
        ðŸ¢: ãŠã§ã‚“: å¤§æ ¹
        ðŸ²: ãªã¹: ç™½èœ, mushrooms
        ðŸ‡°ðŸ‡·: ã‚­ãƒ ãƒ soup
        ðŸš: ä¸‰è‰²ä¸¼ (Avocado Sashimi Mozarella): avocados, mozarella
        ðŸš: ä¸‰è‰²ä¸¼ (Spinach egg ã²ãè‚‰): eggs, spinach, ã²ãè‚‰
        ðŸ: Spinach bacon pasta: spinach, bacon, cream
        ðŸ: Cabbage pasta: cabbage
        ðŸ: Pasta primavera: asparagus, squash, zucchini, mushrooms, tomatoes, white wine
        ðŸ‡¯ðŸ‡µ: ç„¼ããã°: cabbage, carrots
        ðŸ‡°ðŸ‡·: ãƒãƒ‚ãƒŸ Korean pancake thing
        ðŸ‡«ðŸ‡·: Galettes: eggs, tomatoes
        ðŸ‡¨ðŸ‡³: ãƒžãƒ¼ãƒœãƒ‰ãƒ•: tofu, ã²ãè‚‰
        ðŸ†: Eggplant parm: eggplant
        ðŸŽƒ: Pumpkin and ã¤ãã­ stew
        ðŸ§†: Falafel
        ðŸ‡¨ðŸ‡³: ãƒžãƒ¼ãƒœãƒ¼ãªã™: eggplant
        ðŸ¥§: Sheperd's Pie: potatoes, ã²ãè‚‰, carrots
        ðŸ½: Casserole: cream, cheese, carrots
        ðŸ½: Gratin
   `;

  // Convert plain-text list of meals into Javascript object [ {name: "foo", ingredients: new Set(["a", "b"])}, ... ].
  const meals = mealsData.split("\n").map(line => line.trim()).filter(line => line).map(line => {
    const [icon, name, ingredients] = line.split(/: */);
    return {icon, name, ingredients: new Set(ingredients?.split(/, */) ?? [])};
  });

  console.log("Meals", meals);

  // TODO: Check that no ingredients specified in meals that aren't in ingredients
  const ingredients2 = new Set(meals.flatMap(meal => Array.from(meal.ingredients)));

  console.log("Ingredients", ingredients);

  // Display checkbox for each ingredient.
  document.getElementById("ingredients").innerHTML = Array.from(ingredients).sort().map(ingredient =>
    `<li>
        <input type="checkbox" id="${ingredient.name}">
        <label for="${ingredient.name}">${ingredient.icon} ${ingredient.name}</label>
    </li>`).join("");

  // Display list of  meals.
  document.getElementById("meals").innerHTML = meals.sort((a, b) => {
    return a.name > b.name ? 1 : -1;
  }).map(meal =>
      `<li id="${meal.name}">${meal.icon} ${meal.name}</li>`).join("");

  // Update possible meals depending on which checkboxes are checked.
  let possibleMeals = meals.map(meal => meal.name);
  document.addEventListener("change", () => {
    const selectedIngredients = new Set(Array.from(document.querySelectorAll("input:checked")).map(input => input.id))
    console.log("selected ingredients", selectedIngredients);

    // Find meals with any of the selected ingredients.
    // Alternative is to find meal with all the selected ingredients.
    possibleMeals = (selectedIngredients.size > 0  ? meals.filter(meal => selectedIngredients.intersection(meal.ingredients).size > 0) : meals).map(meal => meal.name);

    // Gray out invalid meals, and highlight ones that are still valid.
    for(const meal of document.querySelectorAll("#meals li")) {
      const included = possibleMeals.includes(meal.id)
      meal.classList.toggle("matched", selectedIngredients.size > 0 && included);
    }

    document.getElementById("result").innerHTML = "&nbsp;";
  });

  // Pick one for me.
  let pickedMealIndex;
  function pickOne() {
    let pickedMeal = "";
    if (possibleMeals.length > 0) {
      // Pick a meal that's (if possible) different from the previous one.
      let newPickedMealIndex = Math.floor(Math.random() * possibleMeals.length);
      if (newPickedMealIndex === pickedMealIndex) newPickedMealIndex = (pickedMealIndex + 1) % possibleMeals.length;

      pickedMeal = possibleMeals[newPickedMealIndex];
    }

    // Display new text with a transition effect.
    function setText () {
      document.getElementById("result").textContent = pickedMeal;
    }
    if (document.startViewTransition) {
      document.startViewTransition(setText);
    } else {
      setText();
    }
  }
</script>
</body>
</html>
